---
layout: post
category: "web"
title: "初探HTTP"
tags: http
---

初探HTTP
======

    HTTP：超文本传输协议，严谨的译名为'超文本转移协议',诞生于1989.3

HTTP最初理念
-----------

    借助多文档之间相互关联形成的超文本(HyperText)，连成可相互参阅的WWW(World Wide Web,万维网);

3项WWW构建技术
--------

    HTML(HypereText Markup Language,超文本标记语言)
    HTTP(文档传递协议)
    URL(Uniform Resource Locator,统一资源定位符)

TCP/IP
======
TCP/IP的分层管理
-------

    应用层，传输层，网络层，数据链路层;

分层内容
------

    应用层:提供应用服务时通信的活动，比如FTP和DNS;
    传输层:提供处于网络连接中的两台计算机之间的数据传输，比如TCP和UDP;
    网络层:处理网络上流动的数据包，规定了通过什么的传输路径到达对方计算机，并将数据包传送给对方;
    链路层:处理连接网络的硬件部分，如NIC(网络适配器，即网卡)及光纤等;

TCP/IP通信传输流
--------

    以HTTP举例：
    a. 发送端的客户端在应用层(HTTP协议)发出一个请求；	
    b. 在传输层(TCP协议)把从应用层处接收到的数据(HTTP请求报文)进行分割，并在报文上打上标记序号及
       端口号后转发给网络层；
    c. 网络层(IP协议)增加作为通信目的地的MAC地址后转发给链路层;
    d. 接收端的服务器在链路层接收到数据，按序往上层发送，一直到应用层，至此，为成功接受客户端发送
       的HTTP请求；

IP协议
---------

    a. IP网际协议位于网络层；
    b. 作用为把各种数据包传送给对方;
    c. 两个重要的条件为：IP地址和MAC地址,IP地址指明了节点被分配到的地址，MAC地址是指网卡所属的固定地址；
    d. ARP是一种用以解析地址的协议，根据通信方的IP地址就i可以反查出对应的MAC地址;


可靠的TCP协议
----------

    a.TCP位于传输层，提供可靠的字节流服务;
    b.字节流服务：为了方便运输，将大块数据分割成报文段(segment)为单位的数据包进行管理；


TCP协议的三次握手
-------------

    a. 三次握手(three-way handshaking)
    b. 握手过程中使用了TCP的标志(flag):SYN和ACK
    c. 发送端发送带有SYN标志的数据包给对方，接收端收到后，回传一个带有SYN/ACK标志的数据包
       以示传达确认信息，最后，发送端再回传一个带有ACK标志的数据包，代表'握手'结束；

HTTP无状态协议，减少服务器的CPU及内存资源的消耗
----------

    解决HTTP无状态可以使用Cookie技术，通过在请求和响应报文中写入Cookie信息来控制客户端的状态

HTTP请求及响应
=========


状态码
-----

    状态码的职责是当客户端向服务器端发送请求时，描述返回的请求结果；
    状态码由3位数字的响应类别及原因短语组成，基本响应类别有5种；

    3XX响应结果表明浏览器需要执行某些特殊的处理以正确处理请求，如客户端请求的URI已临时或者永久更改了，服
    务器段接受请求后会返回一个新的URI给客户端，客户端需重新发送请求，重定向是客户端行为，可以观察到地址的
    变化。重定向行为是客户端浏览器做了至少两次的访问请求；

    4XX的响应结果表明客户端是发生错误的原因所在；
    400 请求的内容存在语法错误；
    401 初次接受会弹出一个认证用的对话窗口，第二次显示401表示用户认证失败(BASIC认证)；
    403 代表用户未取得文件系统的访问权限，或者访问权限出现了某些问题；
    404 代表服务器无法找到请求所需的内容，也可以是服务器端拒绝请求且不想说明理由时使用；

    5XX的响应结果表明服务器本身发生错误；
    500 执行请求时发生了错误，也可能是web应用存在bug或某些临时的故障；
    503 表明服务器暂时处于超负荷或者停机维护，无法处理请求；

请求与响应的"中间人"
-----------

    代理是客户端和源服务器之间的"中间人"，接受客户端的请求转发给源服务器，接受源服务器的
    响应转发给客户端；
    一个请求经过一个代理服务器会将代理服务器的主机信息写进Via首部信息；
    代理服务器可以实现对特定URI访问的控制；
    
    缓存代理是在代理服务器转发响应时，会预先将资源的副本(缓存)保留在代理服务器上，当再次接收对相同资源的
    请求时，可以不向源服务器进行请求，而将之前缓存的资源作为响应返回给客户端，缓存也可存在客户端浏览器中，
    在IE中叫临时网络文件。缓存会根据有效期限判断是否向源服务器再次进行请求

    转发请求或响应时，不对报文进行加工的代理类型是透明代理，反之，是非透明代理

"中间人"拓展
------

    网关能接收HTTP请求并提供非HTTP协议服务，如网关连接数据库，使用SQL语句查询数据

    隧道是在客户端与服务器端之间建立一条安全的通信线路，不会对请求进行解析，在通信双方断开连接时结束

现今HTTP存在的问题：
----------

    a. 通信使用明文
    b. 不验证通信方的身份
    c. 无法证明报文的完整性
    d. 一条连接上只可发送一个请求；
    e. 请求只能从客户端开始，客户端不可以接收除响应以外的指令；
    f. 请求/响应首部未经压缩就发送，首部信息越多延迟越大；
    g. 发送冗长的首部，每次相互发送相同的首部造成的浪费较多；
    h. 可任意选择数据压缩格式，非强制压缩发送；
针对以上问题出现的一些解决方法
----------

    Ajax、Comet
    响应返回局部的内容更新，可以做到实时更新，但仍未解决HTTP协议本身存在的问题

    SPDY
    a. 通过单一的TCP连接，可以无限制处理多个HTTP请求
    b. 可以给请求分配优先级，解决因带宽低而导致的响应变慢的问题
    c. 压缩首部
    d. 服务器可以向客户端推送数据
    e. 主动提示客户端请求所需的资源，避免发送不必要的请求

    WebSocket
    服务器可以向客户端推送数据
    可以保持连接状态，首部信息小，通信量减少

更安全的HTTPS
========

    HTTPS：添加了加密及认证机制的HTTP，在原本的HTTP，TCP，IP协议中加入了独立于HTTP的SSL协议
    SSL：独立协议，可配合其他协议使用，是当今世界上应用最为广泛的网络安全技术
SSL协议的慢
------

    SSL的慢分两种，一是通信慢，二是指由于大量消耗了CPU及内存等资源，导致处理速度变慢(加密解密)
	
>爬虫小彩蛋
    在需要爬取登陆的网页时，可以在登陆后查看响应中的Set-Cookie字段(PHPSESSID=***)，字段的值为Session ID,采用该字段发出请求时，会使用以登陆用户的身份对网页进行请求，因为Session ID是用以区分不同用户的等位号；









